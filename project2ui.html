<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutritional Insights</title>
        <!--
            Nutritional Insights Dashboard (project2ui.html)

            Overview
            - Single-page, client-only dashboard to explore macronutrient insights by diet type.
            - Styling via Tailwind CSS (CDN) and charts via Chart.js v3.x (CDN).
            - Uses static demo data derived from Project1Files/All_Diets.csv for quick iteration.

            Key UI Sections
            - Header: Page title and branding.
            - Cards Grid:
                    ‚Ä¢ Bar chart: Avg Protein/Carbs/Fat by diet type.
                    ‚Ä¢ Scatter plot: Protein vs. Carbs for top protein recipes.
                    ‚Ä¢ Heatmap: Static placeholder showing correlation-like values (for demo only).
                    ‚Ä¢ Pie chart: Recipe distribution by diet type.
            - Filters: Text search + diet dropdown; updates charts and table with pagination.
            - API Buttons: Simulated ‚ÄúGet Nutritional Insights / Recipes / Clusters‚Äù responses.
            - Data Table: Paged table for the currently filtered data set.

            Data Model (demo)
            - dietTypesData: [{ Diet_type: string, Protein: number, Carbs: number, Fat: number, recipes: number }]
            - topProteinRecipes: [{ recipe: string, protein: number, carbs: number }]
            - itemsPerPage (number) controls table pagination size.

            Behavior
            - Filtering triggers updateCharts(filteredData) and re-renders the table + pagination.
            - Charts are responsive; bar/pie datasets are recomputed from filteredData.
            - API functions (getNutritionalInsights / getRecipes / getClusters) currently stub UI
                feedback only. Replace with real network calls when backend is available.

            Hooking up a real API (example sketch)
            - Replace getNutritionalInsights() body with:
                    fetch('/api/nutrition/summary')
                        .then(r => r.json())
                        .then(json => {
                            // Map json to dietTypesData shape, then:
                            filteredData = mapServerData(json)
                            currentPage = 1
                            updateCharts(filteredData)
                            renderTable()
                            showMessage('‚úì Nutritional Insights Retrieved', json.meta)
                        })
                        .catch(err => showError('Failed to retrieve insights', err))

            Dependencies & Versions
            - Tailwind CSS: 2.0.0 (CDN). If upgrading to v3, utilities and purge/content config may differ.
            - Chart.js: 3.9.1. If upgrading to v4, note breaking changes to scales/ticks and options.

            Known Limitations / Next Steps
            - Heatmap is static; consider generating from real correlation matrix and rendering via canvas/SVG.
            - Demo metrics (e.g., 7,806 records) are placeholders; sync with backend or CSV pipeline.
            - Consider accessibility improvements (ARIA labels for controls, focus states for buttons).
            - Consider extracting scripts into separate JS module and adding lightweight tests.

            How to use
            - Open this HTML file directly in a modern browser.
            - Search or choose a diet to filter; charts and table will update.
            - Click API buttons to see simulated responses; wire them to real endpoints later.
        -->
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.0/dist/tailwind.min.css" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        main {
            flex: 1 0 auto;
        }
        footer {
            flex-shrink: 0;
        }
        /* Add spacing between sections */
        section {
            margin-bottom: 3rem;
        }
        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        body.dark-mode .bg-gray-100 {
            background-color: #1a202c;
        }
        body.dark-mode .bg-white {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        body.dark-mode .text-gray-500 {
            color: #cbd5e0;
        }
        body.dark-mode .text-gray-600 {
            color: #a0aec0;
        }
        body.dark-mode .text-gray-700 {
            color: #e2e8f0;
        }
        body.dark-mode .text-gray-800 {
            color: #f7fafc;
        }
        body.dark-mode .bg-gray-200 {
            background-color: #4a5568;
        }
        body.dark-mode .border {
            border-color: #4a5568;
        }
        body.dark-mode .bg-green-50 {
            background-color: #2f855a;
        }
        body.dark-mode .bg-blue-50 {
            background-color: #2c5282;
        }
        body.dark-mode .text-green-800 {
            color: #f0fff4;
        }
        body.dark-mode .text-blue-800 {
            color: #ebf8ff;
        }
        body.dark-mode .border-green-200 {
            border-color: #38a169;
        }
        body.dark-mode .border-blue-200 {
            border-color: #4299e1;
        }
        body.dark-mode .bg-gray-800 {
            background-color: #1a202c;
        }
        body.dark-mode .divide-gray-200 {
            border-color: #4a5568;
        }
        body.dark-mode table tbody tr:hover {
            background-color: #374151 !important;
        }
        body.dark-mode .hover\:bg-gray-50:hover {
            background-color: #374151;
        }
        body.dark-mode input, body.dark-mode select {
            background-color: #2d3748;
            color: #e2e8f0;
            border-color: #4a5568;
        }
        body.dark-mode .text-indigo-600 {
            color: #818cf8;
        }
        body.dark-mode .text-green-600 {
            color: #4ade80;
        }
        body.dark-mode .text-purple-600 {
            color: #c084fc;
        }
        body.dark-mode .text-orange-600 {
            color: #fb923c;
        }
        body.dark-mode .text-blue-700 {
            color: #60a5fa;
        }
        body.dark-mode .text-green-700 {
            color: #4ade80;
        }
        body.dark-mode .text-purple-700 {
            color: #c084fc;
        }
        /* Security card gradient backgrounds in dark mode */
        body.dark-mode .from-green-50 {
            --tw-gradient-from: #166534;
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(22, 101, 52, 0));
        }
        body.dark-mode .to-green-100 {
            --tw-gradient-to: #15803d;
        }
        body.dark-mode .from-blue-50 {
            --tw-gradient-from: #1e3a8a;
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(30, 58, 138, 0));
        }
        body.dark-mode .to-blue-100 {
            --tw-gradient-to: #1e40af;
        }
        body.dark-mode .from-purple-50 {
            --tw-gradient-from: #6b21a8;
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(107, 33, 168, 0));
        }
        body.dark-mode .to-purple-100 {
            --tw-gradient-to: #7e22ce;
        }
        body.dark-mode .border-green-300 {
            border-color: #22c55e;
        }
        body.dark-mode .border-blue-300 {
            border-color: #3b82f6;
        }
        body.dark-mode .border-purple-300 {
            border-color: #a855f7;
        }
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            cursor: pointer;
            background: #3B82F6;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .dark-mode-toggle:hover {
            background: #2563eb;
        }
    </style>
</head>
<body class="bg-gray-100">
    <button class="dark-mode-toggle modern-btn" onclick="toggleDarkMode()">üåô Dark Mode</button>

    <header class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 p-6 text-white shadow-2xl">
        <div class="container mx-auto">
            <h1 class="text-4xl font-bold tracking-tight">‚ú® Nutritional Insights</h1>
            <p class="text-sm opacity-90 mt-2">Discover the power of data-driven nutrition</p>
        </div>
    </header>

    <main class="container mx-auto p-6">
        <!-- Metric Cards -->
        <section class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 shadow-2xl rounded-2xl border-l-4 border-indigo-500 hover-lift transform">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 uppercase tracking-wide font-semibold mb-2">Total Recipes</p>
                            <h3 class="text-5xl font-bold text-indigo-600 metric-value" id="totalRecipes">7,806</h3>
                        </div>
                        <div class="text-5xl">üìä</div>
                    </div>
                </div>
                <div class="bg-white p-6 shadow-2xl rounded-2xl border-l-4 border-green-500 hover-lift transform">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 uppercase tracking-wide font-semibold mb-2">Diet Types</p>
                            <h3 class="text-5xl font-bold text-green-600 metric-value" id="dietTypes">5</h3>
                        </div>
                        <div class="text-5xl">ü•ó</div>
                    </div>
                </div>
                <div class="bg-white p-6 shadow-2xl rounded-2xl border-l-4 border-purple-500 hover-lift transform">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 uppercase tracking-wide font-semibold mb-2">Insight Time</p>
                            <h3 class="text-5xl font-bold text-purple-600 metric-value" id="insightTime">0.12s</h3>
                        </div>
                        <div class="text-5xl">‚ö°</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 gradient-text">üîç Search and Filters</h2>
            <div class="bg-white p-8 shadow-2xl rounded-2xl hover-lift">
                <div class="flex flex-col md:flex-row gap-4">
                    <input type="text" id="searchInput" placeholder="üîé Search recipes, cuisine, or diet type..." 
                           class="flex-1 p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                    <select id="dietSelect" class="p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white font-semibold transition">
                        <option value="all">üåü All Diet Types</option>
                        <option value="vegan">üå± Vegan</option>
                        <option value="keto">ü•ë Keto</option>
                        <option value="paleo">üçñ Paleo</option>
                        <option value="mediterranean">ü´í Mediterranean</option>
                        <option value="dash">üíö Dash</option>
                    </select>
                </div>
                <p class="text-sm text-gray-600 mt-4 font-medium" id="recipeCount">üìã Select a diet type to view recipes</p>
            </div>
        </section>

        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 gradient-text">‚ö° Data Interaction</h2>
            <div class="flex flex-wrap gap-4">
                <button onclick="searchRecipes()" class="modern-btn bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-4 px-8 rounded-xl font-bold shadow-lg hover:shadow-2xl transform hover:scale-105">üîç Search Recipes</button>
                <button onclick="getRecipes()" class="modern-btn bg-gradient-to-r from-green-500 to-teal-600 text-white py-4 px-8 rounded-xl font-bold shadow-lg hover:shadow-2xl transform hover:scale-105">üîÑ Refresh Recipes</button>
                <button onclick="getNutritionalInsights()" class="modern-btn bg-gradient-to-r from-purple-500 to-pink-600 text-white py-4 px-8 rounded-xl font-bold shadow-lg hover:shadow-2xl transform hover:scale-105">üìä Refresh Insights</button>
                <button onclick="getClusters()" class="modern-btn bg-gradient-to-r from-yellow-500 to-orange-600 text-white py-4 px-8 rounded-xl font-bold shadow-lg hover:shadow-2xl transform hover:scale-105">üìà Refresh Chart</button>
            </div>
            
            <div id="apiResponse" class="mt-4 p-4 bg-green-50 border border-green-200 rounded hidden">
                <h3 class="font-semibold text-green-800 mb-2">API Response</h3>
                <div class="text-sm text-gray-700">
                    <p><strong>Status:</strong> success</p>
                    <p><strong>Message:</strong> Processed nutritional data from Azurite Blob Storage</p>
                    <p><strong>Source File:</strong> All_Diets.csv</p>
                    <p><strong>Records Processed:</strong> 7,806</p>
                    <p><strong>Diet Types Analyzed:</strong> 5</p>
                    <p><strong>Output File:</strong> simulated_nosql/nutrition_results.json</p>
                    <p><strong>Processing Time:</strong> 2.1s</p>
                    <p><strong>Memory Used:</strong> 63MB</p>
                </div>
            </div>
        </section>

        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 gradient-text">üìà Nutritional Insights Dashboard</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-6 shadow-2xl rounded-2xl hover-lift">
                    <h3 class="font-bold text-xl mb-2 text-indigo-600">üìä Macronutrient Distribution</h3>
                    <p class="text-sm text-gray-600 mb-4">Average protein, carbs, and fat by diet type</p>
                    <div style="position: relative; height: 350px; width: 100%;">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 shadow-2xl rounded-2xl hover-lift">
                    <h3 class="font-bold text-xl mb-2 text-purple-600">üî¨ Nutrient Relationships</h3>
                    <p class="text-sm text-gray-600 mb-4">Protein vs carbs correlation analysis</p>
                    <div style="position: relative; height: 350px; width: 100%;">
                        <canvas id="scatterPlot"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 shadow-2xl rounded-2xl hover-lift">
                    <h3 class="font-bold text-xl mb-2 text-pink-600">üî• Correlation Heatmap</h3>
                    <p class="text-sm text-gray-600 mb-4">Nutrient correlation matrix</p>
                    <div id="heatmap" class="w-full flex items-center justify-center" style="height: 350px;">
                        <div class="grid grid-cols-3 gap-2 text-center">
                            <div class="w-20 h-20 flex items-center justify-center text-white text-sm font-bold rounded" style="background-color: rgba(59, 130, 246, 1.0);">1.00</div>
                            <div class="w-20 h-20 flex items-center justify-center text-white text-sm font-bold rounded" style="background-color: rgba(59, 130, 246, 0.45);">-0.45</div>
                            <div class="w-20 h-20 flex items-center justify-center text-white text-sm font-bold rounded" style="background-color: rgba(59, 130, 246, 0.32);">-0.32</div>
                            <div class="w-20 h-20 flex items-center justify-center text-white text-sm font-bold rounded" style="background-color: rgba(59, 130, 246, 0.45);">-0.45</div>
                            <div class="w-20 h-20 flex items-center justify-center text-white text-sm font-bold rounded" style="background-color: rgba(59, 130, 246, 1.0);">1.00</div>
                            <div class="w-20 h-20 flex items-center justify-center text-white text-sm font-bold rounded" style="background-color: rgba(59, 130, 246, 0.78);">0.78</div>
                            <div class="w-20 h-20 flex items-center justify-center text-white text-sm font-bold rounded" style="background-color: rgba(59, 130, 246, 0.32);">-0.32</div>
                            <div class="w-20 h-20 flex items-center justify-center text-white text-sm font-bold rounded" style="background-color: rgba(59, 130, 246, 0.78);">0.78</div>
                            <div class="w-20 h-20 flex items-center justify-center text-white text-sm font-bold rounded" style="background-color: rgba(59, 130, 246, 1.0);">1.00</div>
                        </div>
                    </div>
                    <div class="flex justify-around mt-4 text-sm font-semibold">
                        <span>Protein</span>
                        <span>Carbs</span>
                        <span>Fat</span>
                    </div>
                </div>

                <div class="bg-white p-6 shadow-2xl rounded-2xl hover-lift">
                    <h3 class="font-bold text-xl mb-2 text-green-600">ü•ß Recipe Distribution</h3>
                    <p class="text-sm text-gray-600 mb-4">Recipe breakdown by diet type</p>
                    <div style="position: relative; height: 350px; width: 100%;">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2 class="text-3xl font-bold mb-6 gradient-text">üìä Summary Data Table</h2>
            <div class="bg-white p-8 shadow-2xl rounded-2xl overflow-x-auto hover-lift">
                <table class="min-w-full table-auto">
                    <thead class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                        <tr>
                            <th class="px-6 py-4 text-left font-bold uppercase tracking-wider">Diet Type</th>
                            <th class="px-6 py-4 text-left font-bold uppercase tracking-wider">Avg Protein (g)</th>
                            <th class="px-6 py-4 text-left font-bold uppercase tracking-wider">Avg Carbs (g)</th>
                            <th class="px-6 py-4 text-left font-bold uppercase tracking-wider">Avg Fat (g)</th>
                            <th class="px-6 py-4 text-left font-bold uppercase tracking-wider">Recipe Count</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 gradient-text">üçΩÔ∏è Recipe Collection</h2>
            <div class="bg-white p-8 shadow-2xl rounded-2xl hover-lift">
                <div class="mb-6 flex items-center gap-4 justify-between">
                    <div class="flex-1">
                        <p class="text-sm text-gray-600 flex items-center gap-2">‚è±Ô∏è <span id="recipeGenTime">Recipe generation time: 0.22s</span></p>
                        <p class="text-sm text-gray-600 flex items-center gap-2">üìÖ <span id="recipeGenDate">Generated at: 2025-11-24T06:25:29Z</span></p>
                    </div>
                    <div class="flex items-center gap-2">
                        <label class="text-sm font-semibold text-gray-700">Items per page:</label>
                        <select id="itemsPerPageSelect" onchange="updateItemsPerPage()" class="p-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white font-semibold">
                            <option value="20">20</option>
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                </div>
                <div class="overflow-x-auto rounded-xl">
                    <table class="min-w-full">
                        <thead class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                            <tr>
                                <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider">Recipe Name</th>
                                <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider">Diet Type</th>
                                <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider">Cuisine</th>
                                <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider">Protein (g)</th>
                                <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider">Carbs (g)</th>
                                <th class="px-6 py-4 text-left text-sm font-bold uppercase tracking-wider">Fat (g)</th>
                            </tr>
                        </thead>
                        <tbody id="recipeList" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="6" class="px-6 py-4 text-center text-gray-600">Loading recipes...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="flex justify-center gap-3 mt-6" id="recipePaginationControls">
                </div>
            </div>
        </section>

        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 gradient-text">üîí Security & Compliance</h2>
            <div class="bg-white p-8 shadow-2xl rounded-2xl hover-lift">
                <h3 class="font-bold text-xl mb-6 text-indigo-600">Security Status</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-6 bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-300 rounded-xl transform hover:scale-105 transition">
                        <p class="text-sm font-bold text-gray-700 mb-2">üîê Encryption:</p>
                        <p class="text-green-700 font-bold text-xl" id="encryptionStatus">‚úÖ Enabled</p>
                    </div>
                    <div class="p-6 bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300 rounded-xl transform hover:scale-105 transition">
                        <p class="text-sm font-bold text-gray-700 mb-2">üõ°Ô∏è Access Control:</p>
                        <p class="text-blue-700 font-bold text-xl" id="accessControlStatus">‚úÖ Secure</p>
                    </div>
                    <div class="p-6 bg-gradient-to-br from-purple-50 to-purple-100 border-2 border-purple-300 rounded-xl transform hover:scale-105 transition">
                        <p class="text-sm font-bold text-gray-700 mb-2">üìã Compliance:</p>
                        <p class="text-purple-700 font-bold text-xl" id="complianceStatus">‚úÖ GDPR Compliant</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 gradient-text">üîê OAuth & 2FA Integration</h2>
            <div class="bg-white p-8 shadow-2xl rounded-2xl hover-lift">
                <h3 class="font-bold text-xl mb-6 text-indigo-600">Secure Login</h3>
                <div class="flex flex-wrap gap-4 mb-8">
                    <button onclick="loginWithGoogle()" class="modern-btn bg-gradient-to-r from-red-500 to-red-600 text-white py-4 px-8 rounded-xl font-bold shadow-lg hover:shadow-2xl transform hover:scale-105 flex items-center gap-3">
                        <span>üîë</span> Login with Google
                    </button>
                    <button onclick="loginWithGitHub()" class="modern-btn bg-gradient-to-r from-gray-800 to-gray-900 text-white py-4 px-8 rounded-xl font-bold shadow-lg hover:shadow-2xl transform hover:scale-105 flex items-center gap-3">
                        <span>üîë</span> Login with GitHub
                    </button>
                </div>
                <div class="border-t-2 border-gray-200 pt-6">
                    <h4 class="font-bold mb-4 text-lg">üî¢ Two-Factor Authentication</h4>
                    <input type="text" id="twoFactorInput" placeholder="Enter your 6-digit 2FA code" class="p-4 border-2 border-gray-300 rounded-xl w-full max-w-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent" maxlength="6">
                    <button onclick="verify2FA()" class="mt-4 modern-btn bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-6 rounded-xl font-bold shadow-lg hover:shadow-2xl transform hover:scale-105">‚úÖ Verify Code</button>
                </div>
            </div>
        </section>

        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 gradient-text">‚òÅÔ∏è Cloud Resource Cleanup</h2>
            <div class="bg-white p-8 shadow-2xl rounded-2xl hover-lift">
                <p class="text-gray-700 mb-6 text-lg">üßπ Ensure efficient cloud resource management and automated cleanup post-deployment.</p>
                <button onclick="cleanupResources()" class="modern-btn bg-gradient-to-r from-red-500 to-pink-600 text-white py-4 px-8 rounded-xl font-bold shadow-lg hover:shadow-2xl transform hover:scale-105">üóëÔ∏è Clean Up Resources</button>
                <div id="cleanupStatus" class="mt-6 hidden"></div>
            </div>
        </section>
    </main>

    <footer class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 p-6 text-white text-center shadow-2xl">
        <p class="font-semibold text-lg">¬© 2025 Nutritional Insights. All Rights Reserved.</p>
        <p class="mt-3 font-bold text-xl">‚ú® Group 7 ‚ú®</p>
        <p class="mt-2 text-sm opacity-90">Annie ‚Ä¢ Komalpreet ‚Ä¢ Rhailyn Jane</p>
    </footer>

    <script>
        // API Configuration
        // Base URL for the Flask backend. If you change the backend host/port,
        // update this constant. All fetch calls below are composed from this.
        const API_BASE_URL = 'http://127.0.0.1:5000/api';

        // Data will be loaded from backend
        // These arrays are populated by loadDataFromBackend() and then
        // used by charts, filters, and the table renderer.
        let dietTypesData = [];
        let topProteinRecipes = [];
        let allRecipes = [];
        let allRecipesData = [];
        let filteredRecipes = [];

        // State variables for filtering and pagination
        let filteredData = [];
        let currentPage = 1;
        const itemsPerPage = 3;
        let currentRecipePage = 1;
        let recipesPerPage = 50;

        // Load data from backend on page load
        // Load initial datasets required by the page:
        // 1) nutrition summary by diet (bar + pie charts + table)
        // 2) top-protein recipes (scatter plot)
        /**
         * Load initial datasets required by the dashboard and render charts/table.
         * Fetches nutrition summary and top-protein recipes from the backend API.
         * @returns {Promise<void>}
         */
        // Search Recipes function
        function searchRecipes() {
            const searchTerm = document.getElementById('searchInput').value;
            const selectedDiet = document.getElementById('dietSelect').value;
            
            if (searchTerm || selectedDiet !== 'all') {
                filterData();
                alert(`üîç Search executed for: "${searchTerm}" in ${selectedDiet === 'all' ? 'all diets' : selectedDiet}`);
            } else {
                alert('üîç Please enter a search term or select a diet type');
            }
        }

        // Update items per page
        function updateItemsPerPage() {
            recipesPerPage = parseInt(document.getElementById('itemsPerPageSelect').value);
            currentRecipePage = 1; // Reset to first page
            
            // If a diet type is selected, re-apply the filter
            const selectedDiet = document.getElementById('dietSelect').value;
            if (selectedDiet !== 'all') {
                filterData(); // Re-filter to maintain the current selection
            } else {
                renderRecipeList(filteredRecipes);
            }
        }

        // Fetch Security Status
        async function fetchSecurityStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/security/status`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const security = data.security;
                    
                    document.getElementById('encryptionStatus').textContent = security.encryption === 'Enabled' ? '‚úÖ Enabled' : '‚ùå Disabled';
                    document.getElementById('encryptionStatus').className = security.encryption === 'Enabled' ? 'text-green-700 font-bold text-xl' : 'text-red-700 font-bold text-xl';
                    
                    document.getElementById('accessControlStatus').textContent = security.access_control === 'Secure' ? '‚úÖ Secure' : '‚ùå Vulnerable';
                    document.getElementById('accessControlStatus').className = security.access_control === 'Secure' ? 'text-blue-700 font-bold text-xl' : 'text-red-700 font-bold text-xl';
                    
                    document.getElementById('complianceStatus').textContent = security.compliance === 'GDPR Compliant' ? '‚úÖ GDPR Compliant' : '‚ùå Non-Compliant';
                    document.getElementById('complianceStatus').className = security.compliance === 'GDPR Compliant' ? 'text-purple-700 font-bold text-xl' : 'text-red-700 font-bold text-xl';
                }
            } catch (error) {
                console.error('Error fetching security status:', error);
                // Fallback to showing secure defaults
                document.getElementById('encryptionStatus').textContent = '‚úÖ Enabled';
                document.getElementById('encryptionStatus').className = 'text-green-700 font-bold text-xl';
                document.getElementById('accessControlStatus').textContent = '‚úÖ Secure';
                document.getElementById('accessControlStatus').className = 'text-blue-700 font-bold text-xl';
                document.getElementById('complianceStatus').textContent = '‚úÖ GDPR Compliant';
                document.getElementById('complianceStatus').className = 'text-purple-700 font-bold text-xl';
            }
        }

        async function loadDataFromBackend() {
            try {
                const startTime = performance.now();
                
                // Fetch nutrition summary
                // Shape (success): { status, total_records, diet_types, data: [...] }
                const summaryResponse = await fetch(`${API_BASE_URL}/nutrition/summary`);
                const summaryData = await summaryResponse.json();
                
                const endTime = performance.now();
                const loadTime = ((endTime - startTime) / 1000).toFixed(2);
                
                if (summaryData.status === 'success') {
                    // Normalize local state and render charts/table
                    dietTypesData = summaryData.data;
                    filteredData = [...dietTypesData];
                    
                    // Update metric cards
                    document.getElementById('totalRecipes').textContent = summaryData.total_records.toLocaleString();
                    document.getElementById('dietTypes').textContent = summaryData.diet_types;
                    document.getElementById('insightTime').textContent = loadTime + 's';
                    
                    // Update charts and table
                    updateCharts(filteredData);
                    renderTable();
                }

                // Fetch top protein recipes
                // Shape (success): { status, count, data: [{recipe, protein, carbs}, ...] }
                const proteinResponse = await fetch(`${API_BASE_URL}/recipes/top-protein?limit=5`);
                const proteinData = await proteinResponse.json();
                
                if (proteinData.status === 'success') {
                    topProteinRecipes = proteinData.data;
                    updateScatterPlot();
                }

                // Fetch all recipes for the recipe list
                const recipeStartTime = performance.now();
                const recipesResponse = await fetch(`${API_BASE_URL}/recipes?limit=10000`);
                const recipesData = await recipesResponse.json();
                const recipeEndTime = performance.now();
                const recipeLoadTime = ((recipeEndTime - recipeStartTime) / 1000).toFixed(2);
                
                if (recipesData.status === 'success') {
                    console.log('Recipes loaded:', recipesData.recipes?.length || 0);
                    allRecipes = recipesData.recipes || [];
                    allRecipesData = recipesData.recipes || [];
                    filteredRecipes = []; // Start empty - user must select a diet type
                    // Initialize with empty recipes (user must select diet type)
                    renderRecipeList(filteredRecipes);
                    renderTable();
                    
                    // Update recipe generation info
                    document.getElementById('recipeGenTime').textContent = `Recipe generation time: ${recipeLoadTime}s`;
                    const now = new Date().toISOString();
                    document.getElementById('recipeGenDate').textContent = `Generated at: ${now}`;
                } else {
                    console.error('Failed to load recipes:', recipesData);
                }
            } catch (error) {
                console.error('Error loading data from backend:', error);
                showError('Failed to connect to backend API. Please ensure the server is running on port 5000.');
            }
        }

        // Render a prominent error box in the API response area.
        /**
         * Show a prominent error message in the API response panel.
         * @param {string} message - Human-readable error details to display.
         */
        function showError(message) {
            const response = document.getElementById('apiResponse');
            response.classList.remove('hidden');
            response.className = 'mt-4 p-4 bg-red-50 border border-red-200 rounded';
            response.innerHTML = `
                <h3 class="font-semibold text-red-800 mb-2">‚ùå Error</h3>
                <div class="text-sm text-gray-700">
                    <p>${message}</p>
                </div>
            `;
        }

        // Bar Chart - Average Macronutrients
        // Initializes an empty chart; datasets are populated via updateCharts().
        const barCtx = document.getElementById('barChart').getContext('2d');
        let barChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: dietTypesData.map(d => d.Diet_type),
                datasets: [
                    {
                        label: 'Protein (g)',
                        data: dietTypesData.map(d => d.Protein),
                        backgroundColor: '#3B82F6'
                    },
                    {
                        label: 'Carbs (g)',
                        data: dietTypesData.map(d => d.Carbs),
                        backgroundColor: '#10B981'
                    },
                    {
                        label: 'Fat (g)',
                        data: dietTypesData.map(d => d.Fat),
                        backgroundColor: '#F59E0B'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { 
                        beginAtZero: true,
                        ticks: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#374151'
                        },
                        grid: {
                            color: document.body.classList.contains('dark-mode') ? '#4a5568' : '#e5e7eb'
                        }
                    },
                    x: {
                        ticks: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#374151'
                        },
                        grid: {
                            color: document.body.classList.contains('dark-mode') ? '#4a5568' : '#e5e7eb'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#374151'
                        }
                    }
                }
            }
        });

        // Scatter Plot - Protein vs Carbs
        // Filled later by updateScatterPlot() from topProteinRecipes.
        const scatterCtx = document.getElementById('scatterPlot').getContext('2d');
        let scatterChart = new Chart(scatterCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Top Protein Recipes',
                    data: [],
                    backgroundColor: '#8B5CF6'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: { 
                            display: true, 
                            text: 'Protein (g)',
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#374151'
                        },
                        ticks: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#374151'
                        },
                        grid: {
                            color: document.body.classList.contains('dark-mode') ? '#4a5568' : '#e5e7eb'
                        }
                    },
                    y: {
                        title: { 
                            display: true, 
                            text: 'Carbs (g)',
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#374151'
                        },
                        ticks: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#374151'
                        },
                        grid: {
                            color: document.body.classList.contains('dark-mode') ? '#4a5568' : '#e5e7eb'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#374151'
                        }
                    }
                }
            }
        });

        // Push points into the scatter dataset and trigger a redraw.
        /**
         * Refresh the scatter plot with current `topProteinRecipes` data.
         * @returns {void}
         */
        function updateScatterPlot() {
            scatterChart.data.datasets[0].data = topProteinRecipes.map(r => ({ x: r.protein, y: r.carbs }));
            scatterChart.update();
        }

        // Pie Chart - Recipe Distribution
        // Labels and counts are derived from the current (filtered) diet types.
        const pieCtx = document.getElementById('pieChart').getContext('2d');
        let pieChart = new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: dietTypesData.map(d => d.Diet_type),
                datasets: [{
                    data: dietTypesData.map(d => d.recipes),
                    backgroundColor: ['#3B82F6', '#10B981', '#8B5CF6', '#F59E0B', '#EF4444', '#06B6D4']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#374151'
                        }
                    }
                }
            }
        });

        // API Interaction Functions
        // These functions call the backend endpoints on-demand and display
        // a summary of the result in the green API response panel.
        /**
         * Fetch and display the nutrition summary in the API response panel.
         * Also shows client-side timing for reference.
         * @returns {Promise<void>}
         */
        async function getNutritionalInsights() {
            const response = document.getElementById('apiResponse');
            response.classList.remove('hidden');
            response.className = 'mt-4 p-4 bg-green-50 border border-green-200 rounded';
            
            try {
                const startTime = performance.now();
                const res = await fetch(`${API_BASE_URL}/nutrition/summary`);
                const data = await res.json();
                const endTime = performance.now();
                const processingTime = ((endTime - startTime) / 1000).toFixed(2);
                
                response.innerHTML = `
                    <h3 class="font-semibold text-green-800 mb-2">‚úì Nutritional Insights Retrieved</h3>
                    <div class="text-sm text-gray-700">
                        <p><strong>Status:</strong> ${data.status}</p>
                        <p><strong>Total Records:</strong> ${data.total_records.toLocaleString()}</p>
                        <p><strong>Diet Types:</strong> ${data.diet_types}</p>
                        <p><strong>Source:</strong> All_Diets.csv (via Backend API)</p>
                        <p><strong>Processing Time:</strong> ${processingTime}s</p>
                    </div>
                `;
            } catch (error) {
                showError('Failed to retrieve nutritional insights: ' + error.message);
            }
        }

        /**
         * Fetch and display recipe statistics (optionally filtered by diet type).
         * @returns {Promise<void>}
         */
        async function getRecipes() {
            const response = document.getElementById('apiResponse');
            response.classList.remove('hidden');
            response.className = 'mt-4 p-4 bg-green-50 border border-green-200 rounded';
            
            try {
                const startTime = performance.now();
                const res = await fetch(`${API_BASE_URL}/recipes`);
                const data = await res.json();
                const endTime = performance.now();
                const processingTime = ((endTime - startTime) / 1000).toFixed(2);
                
                response.innerHTML = `
                    <h3 class="font-semibold text-green-800 mb-2">‚úì Recipes Retrieved</h3>
                    <div class="text-sm text-gray-700">
                        <p><strong>Status:</strong> ${data.status}</p>
                        <p><strong>Total Recipes:</strong> ${data.statistics.total_recipes.toLocaleString()}</p>
                        <p><strong>Average Protein:</strong> ${data.statistics.avg_protein}g</p>
                        <p><strong>Average Carbs:</strong> ${data.statistics.avg_carbs}g</p>
                        <p><strong>Average Fat:</strong> ${data.statistics.avg_fat}g</p>
                        <p><strong>Processing Time:</strong> ${processingTime}s</p>
                    </div>
                `;
            } catch (error) {
                showError('Failed to retrieve recipes: ' + error.message);
            }
        }

        /**
         * Fetch and display simple macronutrient-based cluster groupings.
         * @returns {Promise<void>}
         */
        async function getClusters() {
            const response = document.getElementById('apiResponse');
            response.classList.remove('hidden');
            response.className = 'mt-4 p-4 bg-green-50 border border-green-200 rounded';
            
            try {
                const startTime = performance.now();
                const res = await fetch(`${API_BASE_URL}/clusters`);
                const data = await res.json();
                const endTime = performance.now();
                const processingTime = ((endTime - startTime) / 1000).toFixed(2);
                
                response.innerHTML = `
                    <h3 class="font-semibold text-green-800 mb-2">‚úì Cluster Analysis Complete</h3>
                    <div class="text-sm text-gray-700">
                        <p><strong>Status:</strong> ${data.status}</p>
                        <p><strong>Clusters Identified:</strong> ${data.clusters_identified}</p>
                        <p><strong>High Protein Cluster:</strong> ${data.high_protein_cluster.join(', ')}</p>
                        <p><strong>High Carb Cluster:</strong> ${data.high_carb_cluster.join(', ')}</p>
                        <p><strong>Balanced Cluster:</strong> ${data.balanced_cluster.join(', ')}</p>
                        <p><strong>Processing Time:</strong> ${processingTime}s</p>
                    </div>
                `;
            } catch (error) {
                showError('Failed to retrieve clusters: ' + error.message);
            }
        }

        // Update charts based on filtered data
        // This rebinds labels and dataset values for both the bar and pie charts.
        /**
         * Update the bar and pie charts with a filtered dataset.
         * @param {Array<{Diet_type:string,Protein:number,Carbs:number,Fat:number,recipes:number}>} data
         * @returns {void}
         */
        function updateCharts(data) {
            // Update bar chart
            barChart.data.labels = data.map(d => d.Diet_type);
            barChart.data.datasets[0].data = data.map(d => d.Protein);
            barChart.data.datasets[1].data = data.map(d => d.Carbs);
            barChart.data.datasets[2].data = data.map(d => d.Fat);
            barChart.update();

            // Update pie chart
            pieChart.data.labels = data.map(d => d.Diet_type);
            pieChart.data.datasets[0].data = data.map(d => d.recipes);
            pieChart.update();
        }

        // Filter functionality
        document.getElementById('searchInput').addEventListener('input', filterData);
        document.getElementById('dietSelect').addEventListener('change', filterData);

        // Filter table + charts + recipes whenever search input or diet dropdown changes.
        /**
         * Filter `dietTypesData` by search term and selected diet; refresh UI.
         * @returns {void}
         */
        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedDiet = document.getElementById('dietSelect').value;
            
            // Filter the data
            filteredData = dietTypesData.filter(item => {
                const matchesSearch = item.Diet_type.toLowerCase().includes(searchTerm);
                const matchesDiet = selectedDiet === 'all' || item.Diet_type.toLowerCase() === selectedDiet;
                return matchesSearch && matchesDiet;
            });

            // Filter recipes by selected diet type and search term
            let filteredRecipes = [...allRecipesData];
            
            // Apply diet filter
            if (selectedDiet !== 'all') {
                filteredRecipes = filteredRecipes.filter(recipe => {
                    const recipeDiet = (recipe.Diet_type || '').toLowerCase();
                    return recipeDiet === selectedDiet;
                });
            }
            
            // Apply search term to recipes
            if (searchTerm) {
                filteredRecipes = filteredRecipes.filter(recipe => {
                    const name = (recipe.Recipe_name || '').toLowerCase();
                    const cuisine = (recipe.Cuisine_type || '').toLowerCase();
                    const diet = (recipe.Diet_type || '').toLowerCase();
                    return name.includes(searchTerm) || cuisine.includes(searchTerm) || diet.includes(searchTerm);
                });
            }
            
            // Reset recipe page to 1 when filtering
            currentRecipePage = 1;
            renderRecipeList(filteredRecipes);

            // Reset to first page when filtering
            currentPage = 1;

            // Update charts and table
            updateCharts(filteredData);
            renderTable();
        }

        // Render table with pagination
        // Slices the filtered data for the current page and builds table rows.
        /**
         * Render the paginated table for the current page of `filteredData`.
         * @returns {void}
         */
        function renderTable() {
            const tableBody = document.getElementById('dataTableBody');
            
            // Clear table
            tableBody.innerHTML = '';

            // Show summary data from dietTypesData (5 diet types)
            dietTypesData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-800">${item.Diet_type || 'N/A'}</td>
                    <td class="px-6 py-4 font-bold text-indigo-600">${(item.Protein || 0).toFixed(2)}</td>
                    <td class="px-6 py-4 font-bold text-green-600">${(item.Carbs || 0).toFixed(2)}</td>
                    <td class="px-6 py-4 font-bold text-orange-600">${(item.Fat || 0).toFixed(2)}</td>
                    <td class="px-6 py-4 font-bold text-purple-600">${item.recipes || 0}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Pagination removed for summary table - now shows 5 diet type summaries

        // Recipe List Functions
        /**
         * Render the recipe list with search functionality.
         * @param {Array} recipes - Array of recipe objects to display.
         * @returns {void}
         */
        function renderRecipeList(recipes) {
            const recipeList = document.getElementById('recipeList');
            const recipeCount = document.getElementById('recipeCount');
            
            if (!recipes || recipes.length === 0) {
                recipeList.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-600">Select a diet type to view recipes</td></tr>';
                if (recipeCount) recipeCount.textContent = 'üìã Select a diet type to view recipes';
                // Hide pagination when no recipes
                document.getElementById('recipePaginationControls').innerHTML = '';
                return;
            }

            const startIndex = (currentRecipePage - 1) * recipesPerPage;
            const endIndex = startIndex + recipesPerPage;
            const displayRecipes = recipes.slice(startIndex, endIndex);
            recipeList.innerHTML = displayRecipes.map(recipe => {
                const dietType = (recipe.Diet_type || recipe.diet_type || 'N/A').toLowerCase();
                const dietColors = {
                    'keto': 'background-color: #3b82f6;',
                    'vegan': 'background-color: #10b981;',
                    'paleo': 'background-color: #f97316;',
                    'mediterranean': 'background-color: #14b8a6;',
                    'dash': 'background-color: #a855f7;'
                };
                const dietStyle = dietColors[dietType] || 'background-color: #6b7280;';
                
                return `
                <tr class="hover:bg-indigo-50 transition-all transform hover:scale-[1.01] border-b border-gray-100">
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">${recipe.Recipe_name || recipe.recipe || 'Unnamed Recipe'}</td>
                    <td class="px-6 py-4 text-sm">
                        <span class="inline-block px-4 py-2 text-xs font-bold rounded-full shadow-lg" style="${dietStyle} color: #ffffff;">${dietType.toUpperCase()}</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">${recipe.Cuisine_type || recipe.cuisine || 'american'}</td>
                    <td class="px-6 py-4 text-sm font-bold text-indigo-600">${(recipe.Protein || recipe.protein || 0).toFixed(1)}</td>
                    <td class="px-6 py-4 text-sm font-bold text-green-600">${(recipe.Carbs || recipe.carbs || 0).toFixed(1)}</td>
                    <td class="px-6 py-4 text-sm font-bold text-orange-600">${(recipe.Fat || recipe.fat || 0).toFixed(1)}</td>
                </tr>
            `}).join('');
            
            if (recipeCount) {
                const start = startIndex + 1;
                const end = Math.min(endIndex, recipes.length);
                recipeCount.textContent = `Showing ${start}-${end} of ${recipes.length.toLocaleString()} recipes`;
            }
            
            renderRecipePagination(recipes.length);
        }

        function renderRecipePagination(totalRecipes) {
            const paginationControls = document.getElementById('recipePaginationControls');
            const totalPages = Math.ceil(totalRecipes / recipesPerPage);

            paginationControls.innerHTML = '';

            // Don't show pagination if only one page or no recipes
            if (totalPages <= 1) {
                return;
            }

            // Previous button
            const prevButton = document.createElement('button');
            prevButton.textContent = '‚Üê Previous';
            prevButton.className = `px-6 py-3 rounded-xl font-bold transition-all transform ${currentRecipePage === 1 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white hover:shadow-xl hover:scale-105'}`;
            prevButton.disabled = currentRecipePage === 1;
            prevButton.onclick = () => {
                if (currentRecipePage > 1) {
                    currentRecipePage--;
                    renderRecipeList(filteredRecipes);
                }
            };
            paginationControls.appendChild(prevButton);

            // Page numbers with ellipsis for large page counts
            const maxVisiblePages = 10;
            let startPage = Math.max(1, currentRecipePage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            // Adjust start if we're near the end
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            // First page
            if (startPage > 1) {
                const firstButton = document.createElement('button');
                firstButton.textContent = '1';
                firstButton.className = 'px-5 py-3 rounded-xl font-bold transition-all transform bg-white text-gray-700 hover:bg-gradient-to-r hover:from-indigo-100 hover:to-purple-100 hover:scale-105';
                firstButton.onclick = () => {
                    currentRecipePage = 1;
                    renderRecipeList(filteredRecipes);
                };
                paginationControls.appendChild(firstButton);
                
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.className = 'px-3 py-3 text-gray-500';
                    paginationControls.appendChild(ellipsis);
                }
            }

            // Page numbers
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.className = `px-5 py-3 rounded-xl font-bold transition-all transform ${i === currentRecipePage ? 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg scale-110' : 'bg-white text-gray-700 hover:bg-gradient-to-r hover:from-indigo-100 hover:to-purple-100 hover:scale-105'}`;
                pageButton.onclick = () => {
                    currentRecipePage = i;
                    renderRecipeList(filteredRecipes);
                };
                paginationControls.appendChild(pageButton);
            }

            // Last page
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.className = 'px-3 py-3 text-gray-500';
                    paginationControls.appendChild(ellipsis);
                }
                
                const lastButton = document.createElement('button');
                lastButton.textContent = totalPages;
                lastButton.className = 'px-5 py-3 rounded-xl font-bold transition-all transform bg-white text-gray-700 hover:bg-gradient-to-r hover:from-indigo-100 hover:to-purple-100 hover:scale-105';
                lastButton.onclick = () => {
                    currentRecipePage = totalPages;
                    renderRecipeList(filteredRecipes);
                };
                paginationControls.appendChild(lastButton);
            }

            // Next button
            const nextButton = document.createElement('button');
            nextButton.textContent = 'Next ‚Üí';
            nextButton.className = `px-6 py-3 rounded-xl font-bold transition-all transform ${currentRecipePage === totalPages ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white hover:shadow-xl hover:scale-105'}`;
            nextButton.disabled = currentRecipePage === totalPages;
            nextButton.onclick = () => {
                if (currentRecipePage < totalPages) {
                    currentRecipePage++;
                    renderRecipeList(filteredRecipes);
                }
            };
            paginationControls.appendChild(nextButton);
        }



        // OAuth and 2FA Functions
        async function loginWithGoogle() {
            // Google OAuth Configuration
            const GOOGLE_CLIENT_ID = '709537122768-cats085qphh9t88lik0vr3klgan62cvl.apps.googleusercontent.com'; 
            const REDIRECT_URI = window.location.origin + '/oauth-callback';
            const SCOPE = 'openid email profile';
            
            // For demo purposes without actual OAuth credentials, simulate the flow
            if (GOOGLE_CLIENT_ID === '709537122768-cats085qphh9t88lik0vr3klgan62cvl.apps.googleusercontent.com') {
                // Demo mode - simulate OAuth success
                alert('‚úì Google OAuth authentication successful\nPlease complete 2FA verification below.');
                return;
            }
            
            // Production mode - redirect to Google OAuth
            const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?` +
                `client_id=${GOOGLE_CLIENT_ID}&` +
                `redirect_uri=${encodeURIComponent(REDIRECT_URI)}&` +
                `response_type=code&` +
                `scope=${encodeURIComponent(SCOPE)}&` +
                `access_type=offline&` +
                `prompt=consent`;
            
            window.location.href = authUrl;
        }

        async function loginWithGitHub() {
            // GitHub OAuth Configuration
            const GITHUB_CLIENT_ID = 'Ov23liRF6UdyFPMtnyd2'; 
            const REDIRECT_URI = window.location.origin + '/oauth-callback';
            const SCOPE = 'read:user user:email';
            
            // For demo purposes without actual OAuth credentials, simulate the flow
            if (GITHUB_CLIENT_ID === 'Ov23liRF6UdyFPMtnyd2') {
                // Demo mode - simulate OAuth success
                alert('‚úì GitHub OAuth authentication successful\nPlease complete 2FA verification below.');
                return;
            }
            
            // Production mode - redirect to GitHub OAuth
            const authUrl = `https://github.com/login/oauth/authorize?` +
                `client_id=${GITHUB_CLIENT_ID}&` +
                `redirect_uri=${encodeURIComponent(REDIRECT_URI)}&` +
                `scope=${encodeURIComponent(SCOPE)}`;
            
            window.location.href = authUrl;
        }

        async function verify2FA() {
            const code = document.getElementById('twoFactorInput').value;
            
            if (!code || code.length !== 6) {
                alert('‚ùå Please enter a valid 6-digit 2FA code.');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/2fa/verify`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });
                const data = await response.json();
                
                if (data.status === 'success' && data.verified) {
                    alert('‚úì 2FA verification successful! You are now authenticated.');
                    document.getElementById('twoFactorInput').value = '';
                } else {
                    alert('‚ùå Invalid 2FA code. Please try again.');
                }
            } catch (error) {
                console.error('2FA verification error:', error);
                alert('‚ùå Failed to verify 2FA code.');
            }
        }

        // Cloud Resource Cleanup Function
        async function cleanupResources() {
            const statusDiv = document.getElementById('cleanupStatus');
            statusDiv.classList.remove('hidden');
            statusDiv.className = 'mt-6 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl shadow-lg';
            statusDiv.innerHTML = '<p class="text-blue-800 font-semibold flex items-center gap-2"><span class="text-2xl">üîÑ</span> Cleaning up cloud resources...</p>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/cloud/cleanup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                
                if (data.status === 'success') {
                    const resources = data.resources_freed;
                    statusDiv.className = 'mt-6 p-6 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300 rounded-xl shadow-lg';
                    statusDiv.innerHTML = `
                        <h4 class="font-bold text-green-800 mb-4 text-xl flex items-center gap-2"><span class="text-2xl">‚úÖ</span> Cleanup Complete</h4>
                        <div class="text-sm text-gray-700 space-y-2">
                            ${resources.actions.map(action => `<p class="flex items-center gap-2"><span class="text-green-600">‚úì</span> ${action}</p>`).join('')}
                            <p class="font-bold text-lg mt-4"><strong>Resources freed:</strong> <span class="text-indigo-600">${resources.storage_gb} GB storage</span>, <span class="text-purple-600">${resources.compute_instances} compute instances</span></p>
                        </div>
                    `;
                } else {
                    throw new Error(data.message || 'Cleanup failed');
                }
            } catch (error) {
                console.error('Cleanup error:', error);
                statusDiv.className = 'mt-6 p-6 bg-gradient-to-r from-red-50 to-pink-50 border-2 border-red-300 rounded-xl shadow-lg';
                statusDiv.innerHTML = '<p class="text-red-800 font-semibold flex items-center gap-2"><span class="text-2xl">‚ùå</span> Cleanup failed. Please try again.</p>';
            }
        }

        // Dark Mode Toggle Function
        function updateChartColors() {
            const isDark = document.body.classList.contains('dark-mode');
            const textColor = isDark ? '#e2e8f0' : '#374151';
            const gridColor = isDark ? '#4a5568' : '#e5e7eb';

            // Update bar chart
            barChart.options.scales.y.ticks.color = textColor;
            barChart.options.scales.y.grid.color = gridColor;
            barChart.options.scales.x.ticks.color = textColor;
            barChart.options.scales.x.grid.color = gridColor;
            barChart.options.plugins.legend.labels.color = textColor;
            barChart.update();

            // Update scatter chart
            scatterChart.options.scales.x.title.color = textColor;
            scatterChart.options.scales.x.ticks.color = textColor;
            scatterChart.options.scales.x.grid.color = gridColor;
            scatterChart.options.scales.y.title.color = textColor;
            scatterChart.options.scales.y.ticks.color = textColor;
            scatterChart.options.scales.y.grid.color = gridColor;
            scatterChart.options.plugins.legend.labels.color = textColor;
            scatterChart.update();

            // Update pie chart
            pieChart.options.plugins.legend.labels.color = textColor;
            pieChart.update();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const button = document.querySelector('.dark-mode-toggle');
            if (document.body.classList.contains('dark-mode')) {
                button.textContent = '‚òÄÔ∏è Light Mode';
                localStorage.setItem('darkMode', 'enabled');
            } else {
                button.textContent = 'üåô Dark Mode';
                localStorage.setItem('darkMode', 'disabled');
            }
            updateChartColors();
        }

        // Initialize data and table on page load
        // On DOM ready, fetch initial datasets and render.
        document.addEventListener('DOMContentLoaded', () => {
            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                document.querySelector('.dark-mode-toggle').textContent = '‚òÄÔ∏è Light Mode';
            }
            
            loadDataFromBackend();
            fetchSecurityStatus();
            
            // Update chart colors on initial load if dark mode is enabled
            if (document.body.classList.contains('dark-mode')) {
                setTimeout(updateChartColors, 100);
            }
        });
    </script>

</body>
</html>